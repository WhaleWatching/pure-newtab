<!--
  Chrome Pure Newtab extension.
  Project home: https://github.com/WhaleWatching/pure-newtab
  Author: Edward Cheng
  Require: Polymer
  Under GPLv2
-->
<link rel="import" href="bower_components/polymer/polymer.html">
<style>
  pure-newtab,
  pure-background,
  pure-background-layer {
    display: block;
  }
</style>

<dom-module id="pure-newtab">
  <template>
    <style>
      #background {
        z-index: 0;
      }
      #control-panel {
        z-index: 1;
      }
    </style>
    <pure-background id="background">
    </pure-background>
    <pure-control-panel id="control-panel">
    </pure-control-panel>
  </template>
  <script>
    Polymer({
      is: 'pure-newtab',
      attached: function() {
        this.$['background'].updateBackground('rgba(255,128,0,255)', 'url(https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png)');
      }
    });
  </script>
</dom-module>

<dom-module id="pure-control-panel">
  <template>
    <style>
      :host[state=collapsed] {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: rgba(0, 0, 0, 64);
      }
    </style>
    
  </template>
  <script>
    Polymer({
      is: 'pure-control-panel',
      properties: {
        state: {
          type: String,
          value: 'collapsed',
          observer: '_didUpdateState'
        }
      },
      _didUpdateState: function(newValue, oldValue) {
        switch(newValue) {
        case 'directory':

        }
      }
    });
  </script>
</dom-module>

<dom-module id="pure-background">
  <template>
    <style>
      :host {
        position: absolute;
        height: 100%;
        width: 100%;
      }
      #layer-primary {
        z-index: 0;
      }
      #layer-preview {
        z-index: 1;
      }
      .faded {
        opacity: 0;
      }
    </style>
    <pure-background-layer id="layer-primary"></pure-background-layer>
    <pure-background-layer id="layer-preview" class="faded"></pure-background-layer>
  </template>
  <script>
    Polymer({
      is: 'pure-background',
      updateBackground: function(color, image) {
        this.$['layer-primary'].color = color;
        this.$['layer-primary'].image = image;
      },
      showPreview: function(color, image) {
        this.$['layer-preview'].color = color;
        this.$['layer-preview'].image = image;
        this.$['layer-preview'].classList.remove('faded');
      },
      hidePreview: function() {
        this.$['layer-preview'].classList.add('faded');
      }
    });
  </script>
</dom-module>

<dom-module id="pure-background-layer">
  <template>
    <style>
      :host {
        position: absolute;
        height: 100%;
        width: 100%;

        background-position: center;
        background-color: var(--background-color);
        background-image: var(--background-image);
        background-repeat: var(--background-repeat);
        background-size: var(--background-size);

        transition-property: background-color, opacity;
        transition-duration: var(--transition-duration);
      }
    </style>
  </template>
  <script>
    Polymer({
      is: 'pure-background-layer',
      properties: {
        color: {
          type: String,
          value: 'rgba(0,0,0,0)'
        },
        image: {
          type: String,
          value: 'url()'
        },
        repeat: {
          type: String,
          value: 'repeat'
        },
        size: {
          type: String,
          value: 'initial'
        },
        animationEnabled: {
          type: Boolean,
          value: false,
          observer: '_didUpdateAnimationEnabled'
        }
      },
      observers: [
        '_didUpdateBackground(color, image)',
        '_didUpdateLayout(repeat, size)'
      ],
      _didUpdateBackground: function(color, image) {
        if(typeof(color) == 'string') {
          this.customStyle['--background-color'] = color;
        }
        if(typeof(image) == 'string') {
          this.customStyle['--background-image'] = image;
        }
        this.async(this.updateStyles);
      },
      _didUpdateLayout: function (repeat, size) {
        if(typeof(repeat) == 'string') {
          this.customStyle['--background-repeat'] = repeat;
        }
        if(typeof(size) == 'string') {
          this.customStyle['--background-size'] = size;
        }
        this.async(this.updateStyles);
      },
      _didUpdateAnimationEnabled: function (newValue, oldValue) {
        if (newValue) {
          this.customStyle['--transition-duration'] = '0.28s';
        } else {
          this.customStyle['--transition-duration'] = '0s';
        }
        this.async(this.updateStyles);
      }
    });
  </script>
</dom-module>