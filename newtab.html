<!--
  Chrome Pure Newtab extension.
  Project home: https://github.com/WhaleWatching/pure-newtab
  Author: Edward Cheng
  Require: Polymer
  Under GPLv2
-->
<link rel="import" href="bower_components/polymer/polymer.html">
<style>
  pure-newtab,
  pure-background,
  pure-background-layer {
    display: block;
  }
</style>

<dom-module id="pure-newtab">
  <template>
    <style>
      #background {
        z-index: 0;
      }
    </style>
    <pure-background id="background">
    </pure-background>
  </template>
  <script>
    Polymer({
      is: 'pure-newtab',
      attached: function() {
        this.$['background'].willUpdateBackground('rgba(255,128,0,255)');
      }
    });
  </script>
</dom-module>

<dom-module id="pure-background">
  <template>
    <style>
      :host {
        position: absolute;
        height: 100%;
        width: 100%;
      }
      #layer-primary {
        z-index: 0;
      }
      #layer-preview {
        z-index: 1;
      }
      .faded {
        opacity: 0;
      }
    </style>
    <pure-background-layer id="layer-primary"></pure-background-layer>
    <pure-background-layer id="layer-preview" class="faded"></pure-background-layer>
  </template>
  <script>
    Polymer({
      is: 'pure-background',
      willUpdateBackground: function(color, image) {
        console.log(color);
        this.$['layer-primary'].color = color;
        this.$['layer-primary'].image = image;
      },
      willShowPreview: function(color, image) {
        this.$['layer-preview'].update(color, image);
        this.$['layer-preview'].classList.remove('faded');
      },
      willHidePreview: function() {
        this.$['layer-preview'].classList.add('faded');
      }
    });
  </script>
</dom-module>

<dom-module id="pure-background-layer">
  <template>
    <style>
      :host {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: var(--background-color);
        background-image: var(--background-image);
        transition-property: background-color, opacity;
        transition-duration: 0.18s;
      }
    </style>
  </template>
  <script>
    Polymer({
      is: 'pure-background-layer',
      properties: {
        color: {
          type: String,
          value: 'rgba(0,0,0,0)'
        },
        image: {
          type: String,
          value: 'url()'
        }
      },
      observers: [
        'didUpdateBackground(color, image)'
      ],
      didUpdateBackground: function(color, image) {
        if(typeof(color) == 'string') {
          console.log('--background-color before: ' + this.customStyle['--background-color'])
          this.customStyle['--background-color'] = color;
          console.log('--background-color after: ' + this.customStyle['--background-color'])
        }
        if(typeof(image) == 'string') {
          this.customStyle['--background-image'] = image;
        }
      }
    });
  </script>
</dom-module>